<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Nested Array Output</title>

<style>
body {
    background-color: black;
    color: white;
    font-family: Arial, sans-serif;
    font-size: clamp(16px, 3vw, 24px);
    margin: 0;
    padding: 0;
    text-align: center;
}

.section {
    margin: 30px 0;
}

hr {
    border: none;
    height: 2px;
    background-color: white;
    margin: 40px 0;
}

/* ===============================
   SECTION 1 PLAYER GRID (3/row)
================================ */
#playerButtonContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 10px;
}

.player-button {
    background-color: #222;
    border: 2px solid #555;
    color: white;
    border-radius: 12px;
    padding: 14px;
    flex: 0 1 calc(33.33% - 12px);
    box-sizing: border-box;
    cursor: pointer;
    transition: transform 0.2s, background-color 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.player-button:hover {
    background-color: #333;
    transform: scale(1.03);
}

/* ===============================
   SECTION 2 SCORE GRID (5/row)
================================ */
#scoreButtonContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    padding: 10px;
}

.score-button {
    background-color: #1a1a1a;
    border: 1px solid #444;
    color: white;
    border-radius: 10px;
    padding: 8px;
    flex: 0 1 calc(20% - 10px); /* 5 per row */
    box-sizing: border-box;
    cursor: pointer;
    transition: transform 0.15s, background-color 0.15s;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.score-button:hover {
    background-color: #2a2a2a;
    transform: scale(1.05);
}

.small-emoji {
    font-size: clamp(18px, 4vw, 30px);
}

.small-username {
    font-size: clamp(10px, 2.5vw, 16px);
    margin-top: 4px;
    text-align: center;
}

.small-game {
    font-size: clamp(9px, 2vw, 14px);
    margin-top: 2px;
    color: #bbb;
    text-align: center;
}

/* Shared */
.emoji {
    font-size: clamp(28px, 9vw, 70px);
    line-height: 1;
}

.username {
    font-size: clamp(14px, 4.5vw, 40px);
    margin-top: 8px;
}

.hash {
    font-size: clamp(10px, 3vw, 18px);
    margin-top: 4px;
    color: #aaa;
    word-break: break-all;
}

/* Score content left-aligned */
#playerScoreContainer,
#scoreDetailContainer {
    text-align: left;
    max-width: 900px;
    margin: 20px auto 0 auto;
}

#playerScoreContainer ul,
#scoreDetailContainer ul {
    text-align: left;
}

li {
    word-break: break-word;
}
</style>
</head>

<body>

<h2>Nested Array Output</h2>

<!-- SECTION 1 -->
<div class="section">
    <h3>Grouped By User</h3>
    <div id="playerButtonContainer"></div>
    <div id="playerScoreContainer"></div>
</div>

<hr>

<!-- SECTION 2 -->
<div class="section">
    <h3>All Scores (Reverse JSON Order)</h3>
    <div id="scoreButtonContainer"></div>
    <div id="scoreDetailContainer"></div>
</div>

<script>

fetch(`https://squanky.net/scores/getDev`, {
    method: 'GET',
    headers: { 'Content-Type': 'application/json' }
})
.then(response => {
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    return response.json();
})
.then(data => {

    let players = {};

    data.playerArray.forEach(player_data => {
        players[player_data.hash] = player_data;
        players[player_data.hash].scores = [];
    });

    data.scoresArray.forEach(score => {
        if (players[score.hash]) {
            players[score.hash].scores.push(score);
        }
    });

    /* ===============================
       SECTION 1 â€” PLAYER BUTTONS
    ================================ */

    const buttonContainer = document.getElementById('playerButtonContainer');
    const scoreContainer = document.getElementById('playerScoreContainer');

    for (let person in players) {

        const player = players[person];
        if (!player.username) continue;

        const emoji = player.visuals?.emoji || "ðŸ†•";

        const button = document.createElement('button');
        button.className = 'player-button';

        button.innerHTML = `
            <span class="emoji">${emoji}</span>
            <div class="username">${player.username}</div>
            <div class="hash">${player.hash}</div>
        `;

        button.onclick = () => {
            scoreContainer.innerHTML = `
                <h4>${emoji} ${player.username}</h4>
                <ul>
                    ${[...player.scores].reverse().map(s =>
                        `<li>${s.gameTitle}: ${JSON.stringify(s.data)}</li>`
                    ).join('')}
                </ul>
            `;
        };

        buttonContainer.appendChild(button);
    }

    /* ===============================
       SECTION 2 â€” SCORE BUTTON GRID
    ================================ */

    const scoreButtonContainer = document.getElementById('scoreButtonContainer');
    const scoreDetailContainer = document.getElementById('scoreDetailContainer');

    [...data.scoresArray].reverse().forEach(score => {

        const player = players[score.hash];
        const emoji = player?.visuals?.emoji || "ðŸ†•";
        const username = player?.username || "Unknown";

        const button = document.createElement('button');
        button.className = 'score-button';

        button.innerHTML = `
            <div class="small-emoji">${emoji}</div>
            <div class="small-username">${username}</div>
            <div class="small-game">${score.gameTitle}</div>
        `;

        button.onclick = () => {
            scoreDetailContainer.innerHTML = `
                <h4>${emoji} ${username} â€” ${score.gameTitle}</h4>
                <ul>
                    <li>Hash: ${score.hash}</li>
                    <li>Score Data: ${JSON.stringify(score.data)}</li>
                </ul>
            `;
        };

        scoreButtonContainer.appendChild(button);
    });

})
.catch(error => console.error(error));

</script>

</body>
</html>
