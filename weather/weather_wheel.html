<html>
	<link rel="apple-touch-icon" sizes="128x128" href="/html/img/Boxes15.png">
	<link rel="icon" href="/html/img/Boxes15.png">
	<head>
		<title>Felipe</title>
		<style>
			body { margin: 0; }
			canvas {width: 100%; height: 100%}
		</style>
	</head>

	<body>
		<script src="../../js/src/p5.js"></script>
		<script>

			var dims = [0,0]
			var iconset = ["snow", "rain", "fog", "wind", "cloudy", "partly-cloudy-day", "partly-cloudy-night", "clear-day", "clear-night"]
			var picset = ["❄️", "💦", "🌫️", "🌀", "☁️", "🌤️", "🌤️", "☀️", "🌙"]
			function loadWeather(){	
				fetch("https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/evanston?unitGroup=us&elements=datetime%2CdatetimeEpoch%2Cname%2Clatitude%2Clongitude%2Ctempmax%2Ctempmin%2Ctemp%2Cfeelslikemax%2Cfeelslikemin%2Cfeelslike%2Cprecip%2Cprecipprob%2Cprecipcover%2Cpreciptype%2Csnow%2Csnowdepth%2Cwindgust%2Cwindspeed%2Csunrise%2Csunset%2Cmoonphase%2Cconditions%2Cdescription%2Cicon&include=days%2Chours&key=2WKEX8NVUHXNVV7SYHEX3EQBL&contentType=json", {
				"method": "GET",
				"headers": {}})
				.then((response) => response.json())
				.then((data) => {
					console.log(data)
					console.log(dims)
					console.log(mindim)
					background(100)
					rect(0,0,mindim, mindim)
					push()
					translate(mindim/2, mindim/2)
					//drawFan(data)
					for(var i = 0; i < 24; i++){
						var hour = data.days[0].hours[i]
						var iconint = iconset.findIndex(element => element == hour.icon)
						push()
						line(0,0,0,-mindim/2.5)
						push()
						translate(0,-mindim/2.5)
						circle(0,0,5)
						textSize(50)
						text(picset[iconint], -35,0)
						textSize(20)
						text(hour.feelslike,0,20 )
						pop()
						noStroke()
						fill(100 * (1-((hour.temp + 40) / 150)), 100, 100)
						beginShape()
						vertex(0,0)
						vertex(0,-mindim/2.5 * ((hour.temp + 40) / 150))
						vertex(-mindim/2.5 * ((hour.temp + 40) / 150) * sin(-Math.PI/12),
						-mindim/2.5 * ((hour.temp + 40) / 150) * cos(-Math.PI/12))
						endShape()
						fill(100 * (1-((hour.feelslike + 40) / 150)), 100, 100)
						beginShape()
						vertex(0,0)
						vertex(0,-mindim/2.5 * ((hour.feelslike + 40) / 150))
						vertex(-mindim/2.5 * ((hour.feelslike + 40) / 150) * sin(-Math.PI/12),
						-mindim/2.5 * ((hour.feelslike + 40) / 150) * cos(-Math.PI/12))
						endShape()
						fill(0)
						circle(0,0,50)
						stroke(0)
						line(0,0,0,-mindim/2.5)
						pop()
						rotate(Math.PI / 12)
					}for(var i = 0; i < 24; i++){
						var hour = data.days[0].hours[i]
						var iconint = iconset.findIndex(element => element == hour.icon)
						push()
						line(0,0,0,-mindim/2.5)
						pop()
						rotate(Math.PI / 12)
					}
					pop()
					//drawAllHours(data);
				});
			}

			function setup() {
				createCanvas(windowWidth, windowHeight);
				background(220);
				colorMode(HSB, 100);
				dims = [width, height]
				mindim = (width < height) ? width : height
				
				loadWeather();
			}

			function draw() {
			}

			function drawAllHours(data){
				data.days.forEach((day, dindex) => {
					day.hours.forEach((hour, hindex) => {
						var iconset = ["snow", "rain", "fog", "wind", "cloudy", "partly-cloudy-day", "partly-cloudy-night", "clear-day", "clear-night"]
						var picset = ["❄️", "💦", "🌫️", "🌀", "☁️", "🌤️", "🌤️", "☀️", "🌙"]
						var iconint = iconset.findIndex(element => element == hour.icon)
						push()
						translate(30 + hindex*40,10+dindex*40)
						text(hour.feelslike,0,0 )
						textSize(20)
						rect(0,0,30,30)
						text(picset[iconint], 0,20)
						//showIcon(iconint);
						pop()
					})
				})
			}
			function drawFan(data){
				for(var i = 0; i < 24; i++){
						var hour = data.days[0].hours[i]
						var iconint = iconset.findIndex(element => element == hour.icon)
						push()
						line(0,0,0,-mindim/2.5)
						push()
						translate(0,-mindim/2.5)
						circle(0,0,5)
						textSize(50)
						text(picset[iconint], -35,0)
						textSize(20)
						text(hour.feelslike,0,20 )
						pop()
						noStroke()
						fill(100 * (1-((hour.temp + 40) / 150)), 100, 100)
						rect(-20,0,40,-mindim/2.5 * ((hour.temp + 40) / 150), 5)
						fill(100 * (1-((hour.feelslike + 40) / 150)), 100, 100)
						rect(-20,0,40,-mindim/2.5 * ((hour.feelslike + 40) / 150), 5)
						fill(0)
						circle(0,0,50)
						stroke(0)
						line(0,0,0,-mindim/2.5)
						pop()
						rotate(Math.PI / 12)
					}for(var i = 0; i < 24; i++){
						var hour = data.days[0].hours[i]
						var iconint = iconset.findIndex(element => element == hour.icon)
						push()
						line(0,0,0,-mindim/2.5)
						pop()
						rotate(Math.PI / 12)
					}
			}
		</script>
	</body>
</html>