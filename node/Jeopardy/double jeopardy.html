<html>
	<link rel="apple-touch-icon" sizes="128x128" href="/html/img/Boxes10.png">
	<link rel="icon" href="/html/img/Boxes10.png">
	<head>
		<title>Felipe</title>
		<style>
			body { margin: 0; }
			canvas {width: 100%; height: 100%}
		</style>
	</head>

	<body>
		<script src="../../../js/src/p5.js"></script>
		<script>
            var g_json = null

            function drawBoard(json){
                for(var i = 0; i < json.NumCats; i++){
                    colorMode(HSB).fill(240, 204, 100).strokeWeight(4).stroke(0,0,0);
                    rect(i*windowWidth/json.NumCats,0,windowWidth/json.NumCats, windowHeight/(json.NumQs+1))
                    colorMode(RGB).fill(255, 255, 255).strokeWeight(1).stroke(0,0,0).textSize(30).textStyle(BOLD);
                    text(json.Categories[i].Name, (i+0.5)*windowWidth/json.NumCats,(0.5)*windowHeight/(json.NumQs+1))
                    push()
                    translate(0,windowHeight/(json.NumQs+1))
                    for(var j = 0; j < json.NumQs; j++){   
                        colorMode(HSB).fill(240, 204, 100).strokeWeight(4).stroke(0,0,0);
                        if(mycursor[0] == i && mycursor[1] == j && mycursor[2] == 1) colorMode(HSB).fill(220, 204, 100).strokeWeight(4).stroke(0,0,0);
                        rect(i*windowWidth/json.NumCats,j*windowHeight/(json.NumQs+1),windowWidth/json.NumCats, windowHeight/(json.NumQs+1))
                        if(!json.Categories[i].Questions[j].Done){
                            colorMode(RGB).fill(255, 204, 0).strokeWeight(4).stroke(0,0,0).textSize(50).textStyle(BOLD);
                            text("$" + (j+1)*200, (i+0.5)*windowWidth/json.NumCats,(j+0.5)*windowHeight/(json.NumQs+1))
                        }
                    }
                    pop()
                }
            }
            var fetched = false;
            var q_open = [0,0,0]
            var mycursor = [0,0,0]

            function setup(){
                createCanvas(windowWidth, windowHeight);
                textAlign(CENTER, CENTER);
                fetch('./Questions/questions2b.json')
                    .then((response) => response.json())
                    .then((json) => {
                        g_json = json;  
                        fetched = true;
                        g_json.Categories.forEach(cat => {
                            if(cat.Is_Photos){
                                cat.Questions.forEach(q => {
                                    q.Question = loadImage(q.Question, img => {console.log("done")})
                                })
                            }
                        })
                    })
            }
            function draw(){
                imageMode(CENTER);
                if(!fetched) return;
                if(q_open[0]==0) {drawBoard(g_json); return};
                if(q_open[0]==1) {
                    console.log(q_open[1])
                    if(!q_open[2]){
                        colorMode(HSB).fill(240, 204, 100).strokeWeight(4).stroke(0,0,0);
                        rect(0,0,windowWidth, windowHeight)
                        colorMode(RGB).fill(255, 255, 255).strokeWeight(1).stroke(0,0,0).textSize(60).textStyle(BOLD);
                        text(q_open[1].Question,windowWidth*(0.25/2), 0,windowWidth*0.75, windowHeight)
                    }
                    else{
                        resizeImage(q_open[1].Question, windowWidth*0.75, windowHeight*0.75)
                        image(q_open[1].Question, windowWidth/2, windowHeight/2)
                    }
                    q_open[1].Done = false;
                    
                }
                if(q_open[0]==2) {
                    colorMode(HSB).fill(240, 204, 100).strokeWeight(4).stroke(0,0,0);
                    rect(0,0,windowWidth, windowHeight)
                    colorMode(RGB).fill(255, 255, 255).strokeWeight(1).stroke(0,0,0).textSize(60).textStyle(BOLD);
                    text(q_open[1].Answer,windowWidth*(0.25/2), 0,windowWidth*0.75, windowHeight)
                    q_open[1].Done = true;
                }
            }
            function windowResized() {
                console.log(windowWidth, windowHeight)
                resizeCanvas(windowWidth, windowHeight);
                drawBoard(g_json)
			}
            function mouseClicked() {
                if(q_open[0] != 0) return;
                console.log()
                var coords = [(int)(mouseX / (int)(windowWidth/g_json.NumCats)),(int)(mouseY / (int)(windowHeight/(g_json.NumQs+1)))]
                if(coords[0] < 0 || coords[1] < 1) return;
                console.log(coords)
                console.log(g_json.Categories[coords[0]].Questions[coords[1]-1])
                q_open = [1,g_json.Categories[coords[0]].Questions[coords[1]-1], g_json.Categories[coords[0]].Is_Photos];
                return false;
            }
            function keyPressed() {
                if(key == 'q') q_open[0] = 1;
                if(key == 'a') q_open[0] = 2;
                if(key == 'r') q_open[0] = 0;
                if(key == 'ArrowLeft')  {mycursor[2] = 1; mycursor[0] = (mycursor[0]+g_json.NumCats-1) % g_json.NumCats}
                if(key == 'ArrowRight') {mycursor[2] = 1; mycursor[0] = (mycursor[0]+g_json.NumCats+1) % g_json.NumCats}
                if(key == 'ArrowDown')  {mycursor[2] = 1; mycursor[1] = (mycursor[1]+g_json.NumQs+1) % g_json.NumQs}
                if(key == 'ArrowUp')    {mycursor[2] = 1; mycursor[1] = (mycursor[1]+g_json.NumQs-1) % g_json.NumQs}
                if(key == 'v') q_open = [1,g_json.Categories[mycursor[0]].Questions[mycursor[1]], g_json.Categories[mycursor[0]].Is_Photos];
                console.log(`${key} ${keyCode}`);
            }
            function resizeImage(img, maxw, maxh){
                console.log(img)
                if(img.width > img.height){ img.resize(maxw, maxw * (img.height/img.width) ) }
                if(img.height > img.width){ img.resize(maxh * (img.width/img.height), maxh ) }
            }
		</script>
	</body>
</html>